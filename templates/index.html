<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FWRI Access View</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>
  <header class="app-header">
    <h1><a href="/" class="home-link">FWRI Access View</a></h1>
  </header>


  <!-- Filter Bar -->
  <form class="filter-bar" method="get" action="/">
    <div class="filter-group">
      <label for="search">Search</label>
      <input type="text" id="search" name="search" placeholder="Search..." value="{{ request.args.get('search', '') }}">
    </div>

    <div class="filter-group">
      <label for="employee">Search by Employee</label>
      <input type="text" id="employee" name="employee" list="employee-list"
            placeholder="Enter first and last name"
            value="{{ request.args.get('employee', '') }}">

      <datalist id="employee-list">
        {% for name in entries | map(attribute='employee_name') | unique | sort %}
          <option value="{{ name }}"></option>
        {% endfor %}
      </datalist>

    </div>

    <div class="filter-group">
      <label for="start-date">Start Date</label>
      <input type="date" id="start-date" name="start_date" value="{{ request.args.get('start_date', '') }}">
    </div>

    <div class="filter-group">
      <label for="end-date">End Date</label>
      <input type="date" id="end-date" name="end_date" value="{{ request.args.get('end_date', '') }}">
    </div>

    <div class="filter-group">
      <button type="submit" class="view-btn">Filter</button>
      <a href="/" class="view-btn" style="background:#888; text-decoration:none;">Clear</a>
    </div>
  </form>


  <!-- Title Bar -->
  <div class = "title-bar">
    <div class = "title-inner">
      <h3>Access Event Log</h3>
    </div>
  </div>

  <!-- Access Events Table -->
  <div class = "access-table">
    <table>
      <thead>
        <tr>
          <th>Snapshot</th>
          <th>Employee Photo</th>
          <th>Date / Time</th>
          <th>Employee Name</th>
          <th>Entry Type</th>
          <th>Status</th>
          <th></th>
        </tr>
      </thead>

      <tbody>
        {% for e in entries %}
        <tr>
          <!-- Snapshot -->
          <td>
            {% if e.security_image_src %}
              <img src="{{ e.security_image_src }}" alt="snapshot" class="thumb">
            {% else %}
              <img src="/static/images/snapshot_placeholder.jpg" alt="snapshot" class="thumb">
            {% endif %}
          </td>

          <!-- Employee Photo -->
          <td>
            {% if e.profile_image_src %}
              <img src="{{ e.profile_image_src }}" alt="Employee photo" class="thumb">
            {% else %}
              <img src="/static/images/profile_placeholder.jpg" alt="Employee photo" class="thumb">
            {% endif %}
          </td>


          <!-- 3. Date / Time -->
          <td>{{ e.datetime }}</td>

          <!-- 4. Employee Name -->
          <td>{{ e.employee_name }}</td>

          <!-- 5. Entry Type -->
          <td>{{ e.entry_type }}</td>

          <!-- 6. Status -->
          <td>
            {% if e.is_active == 'Active' %}
              <span class="active">Active</span>
            {% else %}
              <span class="inactive">Inactive</span>
            {% endif %}
          </td>

          <!-- 7. View button -->
          <td><button class="view-btn">View</button></td>
        </tr>

        <!-- DETAILS ROW -->
        <tr class="details">
          <td colspan="7">
            <div class="details-card">
              <!-- Left: Employee Photo -->
              <div class="details-photo">
                {% if e.profile_image_src %}
                  <img src="{{ e.profile_image_src }}" alt="Employee photo">
                {% else %}
                  <img src="/static/images/profile_placeholder.jpg" alt="Employee photo">
                {% endif %}
              </div>


              <!-- Middle: Employee Info -->
              <div class="details-info">
                <h3>Employee Information</h3>
                <p><strong>Name:</strong> {{ e.employee_name }}</p>
                <p><strong>Title:</strong> {{ e.title }}</p>
                <p><strong>Email:</strong> {{ e.email }}</p>
                <p><strong>Birth Date:</strong> {{ e.birth_date }}</p>     
                <p><strong>Start Date:</strong> {{ e.start_date }}</p>     
                <p><strong>Employee ID:</strong> {{ e.employee_id }}</p>
                <p><strong>Keycard ID:</strong> {{ e.keycard_id }}</p>
                <p><strong>Status:</strong> {{ e.is_active }}</p>
              </div>


              <!-- Right: Scanner ID -->
              <div class="details-scanner">
                <p><strong>Scanner ID:</strong> {{ e.scanner_id }}</p>
              </div>
            </div>
          </td>
        </tr>
        {% endfor %}
      </tbody>


    </table>
  </div>

  <!-- JavaScript for toggling details -->
  <script>
    const viewButtons = document.querySelectorAll('.view-btn');
    viewButtons.forEach((btn, index) => {
      btn.addEventListener('click', () => {
        const detailRow = btn.closest('tr').nextElementSibling;
        detailRow.style.display = (detailRow.style.display === 'table-row') ? 'none' : 'table-row';
      });
    });
  </script>
</body>
</html>